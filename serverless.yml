service: yandex-cloud-nodejs
frameworkVersion: "3"

provider:
  name: yandex-cloud
  runtime: nodejs16


plugins:
  - "@yandex-cloud/serverless-plugin"

package:
  patterns:
    - '!**'
    - dist/server/*.js
    - dist/server/certs/*

functions:
  get-state:
    handler: dist/server/get-state.handler
    memorySize: 128
    timeout: 5
    account: functions-sa
    environment:
      YDB_ENDPOINT: ${lockbox:${env:LOCKBOX_SECRET_ID}/ydb_endpoint}
      YDB_DB: ${lockbox:${env:LOCKBOX_SECRET_ID}/ydb_db}

  get-config:
    handler: dist/server/get-config.handler
    memorySize: 128
    timeout: 5
    account: functions-sa
    environment:
      YDB_ENDPOINT: ${lockbox:${env:LOCKBOX_SECRET_ID}/ydb_endpoint}
      YDB_DB: ${lockbox:${env:LOCKBOX_SECRET_ID}/ydb_db}

  login:
    handler: dist/server/login.handler
    memorySize: 128
    timeout: 5
    account: functions-sa
    environment:
      YDB_ENDPOINT: ${lockbox:${env:LOCKBOX_SECRET_ID}/ydb_endpoint}
      YDB_DB: ${lockbox:${env:LOCKBOX_SECRET_ID}/ydb_db}
      TG_BOT_TOKEN: ${lockbox:${env:LOCKBOX_SECRET_ID}/tg_bot_token}


  auth:
    handler: dist/server/auth.handler
    memorySize: 128
    timeout: 5
    account: functions-sa
    environment:
      YDB_ENDPOINT: ${lockbox:${env:LOCKBOX_SECRET_ID}/ydb_endpoint}
      YDB_DB: ${lockbox:${env:LOCKBOX_SECRET_ID}/ydb_db}
      TG_BOT_TOKEN: ${lockbox:${env:LOCKBOX_SECRET_ID}/tg_bot_token}


resources:
  functions-sa:
    type: yc::ServiceAccount
    roles:
      - editor
  serverless-game-files:
    type: yc::ObjectStorageBucket
